<mat-card class="convert-card">
  <mat-card-header>
    <mat-card-title>{{ 'convertJsonToExcel.title' | translate }}</mat-card-title>
    <mat-card-subtitle>{{ 'convertJsonToExcel.subtitle' | translate }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <p class="lead">{{ 'convertJsonToExcel.description' | translate }}</p>

    <div class="controls">
      <input
        #fileInput
        id="fileInput"
        type="file"
        accept="application/json,application/*+json,.json"
        multiple
        hidden
        (change)="onFileSelected($event)"
        />

      <button mat-stroked-button color="primary" (click)="fileInput.click()" aria-label="{{ 'convertJsonToExcel.chooseFiles' | translate }}">
        {{ 'convertJsonToExcel.chooseFiles' | translate }}
      </button>

      <mat-form-field appearance="outline" class="format-field">
        <mat-label>{{ 'convertJsonToExcel.outputFormat' | translate }}</mat-label>
        <mat-select [value]="outputFormat" (selectionChange)="onFormatChange($any($event))">
          <mat-option value="xlsx">{{ 'convertJsonToExcel.excel' | translate }}</mat-option>
          <mat-option value="csv">{{ 'convertJsonToExcel.csv' | translate }}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="spacer"></div>

      <div class="action-buttons">
        <button
          mat-flat-button
          color="accent"
          (click)="convertFiles()"
          [disabled]="isProcessing || selectedFiles.length === 0"
          >
          @if (!isProcessing) {
            {{ 'convertJsonToExcel.convertButton' | translate }}
          }
          @if (isProcessing) {
            <mat-progress-spinner diameter="18" mode="indeterminate"></mat-progress-spinner>
            <span class="processing-text">{{ 'convertJsonToExcel.processing' | translate }}</span>
          }
        </button>

        <button mat-button color="warn" (click)="reset()" [disabled]="isProcessing">{{ 'convertJsonToExcel.resetButton' | translate }}</button>
      </div>
    </div>

    @if (selectedFiles.length > 0) {
      <section class="files">
        <h3 class="files-title">{{ 'convertJsonToExcel.selectedFiles' | translate }} ({{ selectedFiles.length }})</h3>
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 file-table" aria-label="{{ 'convertJsonToExcel.selectedFiles' | translate }}">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.fileName' | translate }}</th>
            <td mat-cell *matCellDef="let file">{{ file.name }}</td>
          </ng-container>
          <ng-container matColumnDef="size">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.size' | translate }}</th>
            <td mat-cell *matCellDef="let file">{{ formatSize(file.size) }}</td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.actions' | translate }}</th>
            <td mat-cell *matCellDef="let file">
              <button mat-icon-button color="warn" aria-label="{{ 'convertJsonToExcel.remove' | translate }}" (click)="removeFile(file)">
                <svg width="18" height="18" viewBox="0 0 24 24">
                  <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" [attr.data-file-name]="row?.name"></tr>
        </table>
      </section>
    } @else {
      <div class="no-files">
        <mat-card class="no-files-card">{{ 'convertJsonToExcel.noFilesSelected' | translate }}</mat-card>
      </div>
    }


    <div class="messages">
      @if (errorMessage) {
        <mat-card class="message error">{{ errorMessage }}</mat-card>
      }
      @if (serviceSuccessMessage || successMessage) {
        <mat-card class="message success">{{ serviceSuccessMessage || successMessage }}</mat-card>
      }
    </div>
  </mat-card-content>

  <mat-card-footer class="footer">
    <small>{{ 'convertJsonToExcel.tip' | translate }}</small>
  </mat-card-footer>

  @if (isProcessing) {
    <div class="overlay">
      <mat-progress-spinner color="primary" diameter="64" mode="indeterminate"></mat-progress-spinner>
      <div class="overlay-text">{{ 'convertJsonToExcel.processing' | translate }}</div>
    </div>
  }
</mat-card>
