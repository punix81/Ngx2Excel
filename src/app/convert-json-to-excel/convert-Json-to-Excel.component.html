<section class="convert-card" appearance="outlined">
  <header>
    <h2 class="card-title">{{ 'convertJsonToExcel.title' | translate }}</h2>
    <p class="card-subtitle">{{ 'convertJsonToExcel.subtitle' | translate }}</p>
  </header>

  <div class="card-content">
    <p class="lead">{{ 'convertJsonToExcel.description' | translate }}</p>

    <div class="controls">
      <input
        #fileInput
        id="fileInput"
        type="file"
        accept="application/json,application/*+json,.json"
        multiple
        hidden
        (change)="onFileSelected($event)"
        />

      <button mat-stroked-button color="primary" (click)="fileInput.click()" aria-label="{{ 'convertJsonToExcel.chooseFiles' | translate }}">
        {{ 'convertJsonToExcel.chooseFiles' | translate }}
      </button>

      <mat-form-field appearance="outline" class="format-field">
        <mat-label>{{ 'convertJsonToExcel.outputFormat' | translate }}</mat-label>
        <mat-select [value]="outputFormat" (selectionChange)="onFormatChange($any($event))">
          <mat-option value="xlsx">{{ 'convertJsonToExcel.excel' | translate }}</mat-option>
          <mat-option value="csv">{{ 'convertJsonToExcel.csv' | translate }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    @if (selectedFiles.length > 0) {
      <section class="files">
        <h3 class="files-title">{{ 'convertJsonToExcel.selectedFiles' | translate }} ({{ selectedFiles.length }})</h3>
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 file-table" aria-label="{{ 'convertJsonToExcel.selectedFiles' | translate }}">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.fileName' | translate }}</th>
            <td mat-cell *matCellDef="let file">{{ file.name }}</td>
          </ng-container>
          <ng-container matColumnDef="size">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.size' | translate }}</th>
            <td mat-cell *matCellDef="let file">{{ formatSize(file.size) }}</td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>{{ 'convertJsonToExcel.actions' | translate }}</th>
            <td mat-cell *matCellDef="let file">

                <button matIconButton aria-label="{{ 'convertJsonToExcel.remove' | translate }}" (click)="removeFile(file)">
                    <mat-icon>delete</mat-icon>
                </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns" [attr.data-file-name]="row?.name"></tr>
        </table>
      </section>
    } @else {
      <div class="no-files">
        <div class="no-files-card">{{ 'convertJsonToExcel.noFilesSelected' | translate }}</div>
      </div>
    }

    <div class="messages">
      @if (errorMessage) {
        <div class="message error">{{ errorMessage }}</div>
      }
      @if (serviceSuccessMessage || successMessage) {
        <div class="message success">{{ serviceSuccessMessage || successMessage }}</div>
      }
    </div>
  </div>
    @if (isProcessing) {
    <div class="overlay">
        <mat-progress-spinner color="primary" diameter="64" mode="indeterminate"></mat-progress-spinner>
        <div class="overlay-text">{{ 'convertJsonToExcel.processing' | translate }}</div>
    </div>
    }

  <footer class="footer">
    <small>{{ 'convertJsonToExcel.tip' | translate }}</small>

      <div class="controls">
          <div class="action-buttons">
              <button
                      mat-flat-button
                      color="accent"
                      (click)="convertFiles()"
                      [disabled]="isProcessing || selectedFiles.length === 0"
              >
                  @if (!isProcessing) {
                  {{ 'convertJsonToExcel.convertButton' | translate }}
                  }
                  @if (isProcessing) {
                  <mat-progress-spinner diameter="18" mode="indeterminate"></mat-progress-spinner>
                  <span class="processing-text">{{ 'convertJsonToExcel.processing' | translate }}</span>
                  }
              </button>

              <button mat-button color="warn" (click)="reset()" [disabled]="isProcessing">{{ 'convertJsonToExcel.resetButton' | translate }}</button>
          </div>
      </div>

  </footer>

</section>
